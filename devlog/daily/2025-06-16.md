# 2025-06-16 日次ログ

## GitHub Issue取得機能のデバッグと改善

### 概要
GitHub MCPサーバーを使用したIssue取得機能において発生していた「401 Bad credentials」エラーのデバッグと、`npm`（実際には`pnpm`）コマンド経由でのMCPサーバー起動設定の導入を行いました。

### 問題点
- GitHub MCPサーバーがGitHub APIへの認証に失敗し、「401 Bad credentials」エラーが発生していました。
- `.env.server`ファイルにトークンを記述しても、Dockerコンテナに正しく渡されていませんでした。
- ユーザーは`npm`コマンド（実際には`pnpm`）でMCPサーバーを起動したいと要望していました。

### 実施内容

1.  **GitHub個人アクセストークンの確認と設定**:
    - ユーザーにGitHub個人アクセストークンの再生成と、`repo`または`public_repo`スコープの確認を依頼しました。
    - `.env.server`ファイルに`GITHUB_PERSONAL_ACCESS_TOKEN=your_actual_token_here`の形式でトークンが記述されていることを確認しました。

2.  **`dotenv`パッケージのインストール**:
    - `frontend`ディレクトリで`pnpm install dotenv`コマンドを実行し、`dotenv`パッケージをインストールしました。これにより、Node.jsスクリプトから`.env.server`ファイルを読み込むことが可能になりました。

3.  **GitHub MCPサーバー起動スクリプトの作成**:
    - `frontend/scripts/start-github-mcp.js`という新しいNode.jsスクリプトファイルを作成しました。
    - このスクリプトは、`dotenv`を使用して`.env.server`から`GITHUB_PERSONAL_ACCESS_TOKEN`を読み込み、そのトークンを環境変数としてDockerコマンドに渡し、GitHub MCPサーバーを起動するロジックを含んでいます。

4.  **`frontend/package.json`スクリプトの追加**:
    - `frontend/package.json`の`scripts`セクションに、`"start-github-mcp": "node -r dotenv/config scripts/start-github-mcp.js"`という新しいスクリプトを追加しました。これにより、`pnpm run start-github-mcp`コマンドでGitHub MCPサーバーを起動できるようになりました。

5.  **`.roo/mcp.json`の設定変更**:
    - `.roo/mcp.json`ファイル内のGitHub MCPサーバーの設定を更新し、`command`を`pnpm`、`args`を`["run", "start-github-mcp"]`、`cwd`を`frontend`に設定しました。
    - これにより、VS CodeのMCPサーバーは、GitHub MCPサーバーを起動する際に`frontend`ディレクトリで`pnpm run start-github-mcp`コマンドを実行するようになります。

### 結果
- 上記の変更により、GitHub MCPサーバーがGitHub APIへの認証に成功し、Issueリストを正常に取得できるようになりました。
- ユーザーの要望通り、`pnpm`コマンド経由でGitHub MCPサーバーを起動するフローが確立されました。

## Issue #3 バックエンド基盤のセットアップ

### 概要
Go言語を使用したバックエンドAPIの基盤を構築しました。Ginフレームワークの導入、ヘルスチェックエンドポイントの実装、Viperによる設定管理、および基本的なディレクトリ構造の作成を行いました。

### 実施内容

1.  **Goプロジェクトの初期化とGinフレームワークの導入**:
   - `backend/` ディレクトリで `go mod init futarino-kakei/backend` を実行し、Goモジュールを初期化しました。
   - `go get github.com/gin-gonic/gin` を実行し、Ginフレームワークを導入しました。

2.  **ヘルスチェックAPIエンドポイントの実装**:
   - `backend/cmd/server/main.go` を修正し、`/health` エンドポイントを追加しました。このエンドポイントは `200 OK` を返します。

3.  **基本的なディレクトリ構造の作成**:
   - `backend/internal/handler`, `backend/internal/service`, `backend/internal/repository` ディレクトリを作成しました。

4.  **Viperによる設定管理の導入**:
   - `go get github.com/spf13/viper` を実行し、Viperを導入しました。
   - `backend/internal/config/config.go` を作成し、Viperを使用して `configs/config.yaml` および `.env` ファイルから設定を読み込むロジックを実装しました。
   - `backend/configs/config.yaml` を作成し、データベース接続情報のサンプルを設定しました。
   - `backend/.env` を作成し、データベース接続情報を環境変数として設定しました。
   - `.env` ファイルがGitにコミットされないように、`backend/.gitignore` に `.env` を追加しました。

5.  **`main.go` の設定読み込みの修正**:
   - `backend/cmd/server/main.go` を修正し、`config.LoadConfig()` を呼び出して設定をロードするようにしました。
   - `.env` ファイルが見つからない場合でもエラーとならないように、`backend/internal/config/config.go` のエラーハンドリングを修正しました。

### 結果
- バックエンドAPIサーバーがGinフレームワークを使用して正常に起動し、`/health` エンドポイントが機能することを確認しました。
- 環境変数と設定ファイルの両方からデータベース接続情報を読み込める基盤が構築されました。
- GitHub Issue #3 の受け入れ条件をすべて満たし、Issueのチェックボックスを更新しました。
- 関連する変更は `feature/3-backend-setup` ブランチにコミットされました。
