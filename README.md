# カップル・夫婦専用家計アプリ「ふたりの家計」

## プロダクト概要
カップル・夫婦が共同で家計管理を行うためのWebアプリケーション

### 技術スタック
- **フロントエンド**: Next.js 14+ (App Router)
  - TypeScript
  - Material-UI (MUI)
  - Zustand (状態管理)
  - React Hook Form
- **バックエンド**: Laravel 11+
  - PHP 8.2+
  - MySQL 8.0+
  - Laravel Sanctum (認証)
- **開発環境**: Docker Compose
- **デプロイ**: Vercel (フロントエンド), AWS/VPS (バックエンド)

### 開発環境セットアップ

#### 前提条件
- Docker Desktop
- Git

#### Docker環境での起動（推奨）
```bash
# リポジトリをクローン
git clone https://github.com/takeshi-arihori/futarino-kakei.git
cd futarino-kakei

# Docker Composeで全サービスを起動
docker compose up -d

# アプリケーションにアクセス
# フロントエンド: http://localhost:3000
# バックエンドAPI: http://localhost:8000/api
# Nginx (リバースプロキシ): http://localhost
# MySQL: localhost:3307
```

#### 個別環境での起動
##### フロントエンド (Next.js)
```bash
cd front-end
npm install
npm run dev
```

##### バックエンド (Laravel)
```bash
cd back-end
composer install
cp .env.example .env
php artisan key:generate
php artisan migrate
php artisan serve
```

### 実装済み機能

#### ✅ 認証システム
- ユーザー登録・ログイン
- JWT認証
- 認証状態の永続化とキャッシュ（5分間）
- パフォーマンス最適化済み

#### ✅ 基本画面構成
- ダッシュボード
- ログイン・登録画面
- レスポンシブデザイン

#### ✅ 開発環境
- Docker Compose統合環境
- フロントエンド・バックエンド・DB・Nginxの連携
- CORS設定済み

### API仕様

#### 認証エンドポイント
- `POST /api/register` - ユーザー登録
- `POST /api/login` - ログイン
- `POST /api/logout` - ログアウト
- `GET /api/user` - 認証ユーザー情報取得

#### 支出管理エンドポイント（実装予定）
- `GET /api/expenses` - 支出一覧取得
- `POST /api/expenses` - 支出登録
- `PUT /api/expenses/{id}` - 支出更新
- `DELETE /api/expenses/{id}` - 支出削除

### データベース設計

#### 実装済みテーブル
- `users` - ユーザー情報
- `couples` - カップル関係管理
- `expenses` - 支出記録
- `personal_access_tokens` - 認証トークン

### プロジェクト構造
```
futarino-kakei/
├── front-end/         # Next.js アプリケーション
│   ├── src/
│   │   ├── app/       # App Router
│   │   ├── components/
│   │   ├── lib/
│   │   ├── store/     # Zustand状態管理
│   │   └── types/
│   ├── public/
│   ├── Dockerfile
│   └── package.json
├── back-end/          # Laravel API
│   ├── app/
│   │   ├── Http/Controllers/Api/
│   │   └── Models/
│   ├── database/
│   │   ├── migrations/
│   │   └── seeders/
│   ├── routes/
│   ├── nginx.conf     # Nginx設定
│   ├── Dockerfile
│   └── composer.json
├── docker-compose.yml # Docker環境設定
├── README-Docker.md   # Docker詳細ガイド
└── README.md         # このファイル
```

### 機能要件

#### 1. ユーザー管理機能
- **ユーザー登録**: 最大2名まで登録可能
- **ログイン機能**: 認証システム
- **ユーザー識別**: 個人別の支出記録管理

#### 2. 支出管理機能
##### 2.1 支出記録
- **支出入力**: 金額、日付、カテゴリ、メモ
- **記録者識別**: どちらのユーザーが支出したかを記録
- **編集・削除**: 精算前の支出は修正可能

##### 2.2 カテゴリ管理
- **既定カテゴリ**: システム標準のカテゴリを用意
  - 食費、光熱費、家賃、交通費、娯楽費、日用品、医療費、その他など
- **カスタムカテゴリ**: ユーザーが独自カテゴリを追加可能

#### 3. 共有・分担機能
##### 3.1 表示モード
- **個別管理ページ**: 各ユーザーの個人支出表示
- **共通管理ページ**: 二人の支出を統合表示

##### 3.2 分担比率設定
- **比率設定**: 支出の分担比率を設定可能（例：50:50、60:40など）
- **カテゴリ別設定**: カテゴリごとに異なる分担比率設定可能

##### 3.3 精算機能
- **精算計算**: 設定した分担比率に基づき支払額を計算
- **支払金額表示**: 片方がもう片方へ支払う金額を表示
- **精算確定**: 精算後は原則として修正不可
- **精算履歴**: 過去の精算記録を保持・表示

#### 4. 分析・レポート機能
##### 4.1 期間別レポート
- **月次レポート**: 月別の支出状況
- **年次レポート**: 年別の支出状況
- **カスタム期間**: 任意期間での集計

##### 4.2 可視化機能
- **グラフ表示**: 円グラフ、棒グラフ、線グラフ
- **カテゴリ別分析**: カテゴリごとの支出割合
- **トレンド分析**: 時系列での支出傾向

#### 5. 予算管理機能
- **月次予算設定**: 月ごとの予算上限設定
- **カテゴリ別予算**: カテゴリごとの予算設定
- **予算対実績**: 予算と実際の支出を比較表示
- **予算アラート**: 予算超過時の警告表示

#### 6. 通知機能
- **予算アラート**: 予算の80%、100%到達時の通知
- **精算リマインド**: 定期的な精算促進通知
- **支出登録リマインド**: 支出記録の促進通知

#### 7. データ管理機能
##### 7.1 インポート・エクスポート
- **CSVアップロード**: 既存データの一括インポート
- **CSVダウンロード**: データの一括エクスポート
- **データフォーマット**: 標準的なCSV形式での入出力

##### 7.2 データ保持
- **保存期間**: 最長3年間のデータ保持
- **自動削除**: 3年経過データの自動削除
- **バックアップ**: データの定期バックアップ

### 画面構成（想定）
#### メイン画面
- **ダッシュボード**: 今月の支出状況、予算残高表示
- **支出入力画面**: 新規支出の登録
- **支出一覧画面**: 個別・共通の支出履歴表示
- **精算画面**: 分担計算と精算実行
- **レポート画面**: グラフ・チャートでの分析表示
- **設定画面**: 分担比率、カテゴリ、予算設定

### 非機能要件
#### セキュリティ
- ユーザー認証の実装
- データの暗号化
- プライバシー保護

#### パフォーマンス
- レスポンシブデザイン
- 高速なデータ処理
- モバイル対応

#### 拡張性
- 将来的な収入管理機能追加に対応
- 追加機能の実装余地を確保

### 開発ロードマップ

#### ✅ Phase 1（完了）- 基盤構築
- ユーザー認証システム
- 基本画面構成（ダッシュボード、ログイン、登録）
- Docker開発環境
- パフォーマンス最適化（認証キャッシュ、リダイレクト高速化）

#### 🚧 Phase 2（開発中）- 支出管理機能
- 支出記録機能
- カテゴリ管理
- 支出一覧・編集・削除
- 個別・共通ページ表示

#### 📋 Phase 3（予定）- 分担・精算機能
- 分担比率設定
- 精算計算・実行
- 精算履歴管理

#### 📋 Phase 4（予定）- 分析・レポート機能
- 月次・年次レポート
- グラフ・チャート表示
- カテゴリ別分析

#### 📋 Phase 5（予定）- 高度な機能
- 予算管理機能
- 通知機能
- CSV入出力
- UI/UX改善

### パフォーマンス最適化

#### 実装済み最適化
- **認証キャッシュ**: 5分間のキャッシュでAPI呼び出しを削減
- **重複処理防止**: 同時実行される認証チェックを制御
- **条件付きAPI呼び出し**: 必要な場合のみAPIリクエストを実行
- **高速リダイレクト**: 認証状態に基づく即座のページ遷移

### 開発ガイドライン

#### コーディング規約
- **フロントエンド**: ESLint + Prettier設定に従う
- **バックエンド**: PSR-12準拠
- **コミットメッセージ**: Conventional Commits形式

#### ブランチ戦略
- `main`: 本番環境
- `feature/*`: 機能開発
- `hotfix/*`: 緊急修正

#### テスト方針
- **フロントエンド**: Jest + React Testing Library
- **バックエンド**: PHPUnit
- **E2E**: Playwright（予定）

### トラブルシューティング

#### よくある問題
1. **Docker起動エラー**: Docker Desktopが起動していることを確認
2. **ポート競合**: 他のアプリケーションがポート3000, 8000, 80を使用していないか確認
3. **認証エラー**: バックエンドAPIサーバーが正常に起動していることを確認

詳細なトラブルシューティングは [README-Docker.md](./README-Docker.md) を参照してください。

### コントリビューション
プルリクエストを歓迎します。大きな変更を行う場合は、まずIssueを作成して議論してください。

### ライセンス
このプロジェクトはMITライセンスの下で公開されています。

---

**現在のバージョン**: v1.0.0-alpha  
**最終更新**: 2025年5月28日
