# カップル・夫婦専用家計アプリ 要件定義書

[ふたりの家計](futarino-kakei.com)  

## プロダクト概要
カップル・夫婦が共同で家計管理を行うためのWebアプリケーション

### 技術スタック
- フロントエンド: Next.js 14+
  - [Next.jsドキュメント](https://nextjs.org/docs)
  - TypeScript使用
  - Tailwind CSS
- バックエンド(API): Laravel 11+
  - [Laravelドキュメント](https://laravel.com/docs/12.x/releases)
  - PHP 8.2+
  - MySQL 8.0+
- 認証: Laravel Sanctum
- デプロイ: Vercel (フロントエンド), AWS/VPS (バックエンド)

### 開発環境セットアップ

#### 前提条件
- Node.js 18+
- PHP 8.2+
- Composer
- MySQL 8.0+

#### フロントエンド (Next.js)
```bash
cd frontend
npm install
npm run dev
```

#### バックエンド (Laravel)
```bash
cd backend
composer install
cp .env.example .env
php artisan key:generate
php artisan migrate
php artisan serve
```

### API仕様概要

#### 認証エンドポイント
- `POST /api/register` - ユーザー登録
- `POST /api/login` - ログイン
- `POST /api/logout` - ログアウト

#### 支出管理エンドポイント
- `GET /api/expenses` - 支出一覧取得
- `POST /api/expenses` - 支出登録
- `PUT /api/expenses/{id}` - 支出更新
- `DELETE /api/expenses/{id}` - 支出削除

#### 精算エンドポイント
- `GET /api/settlements` - 精算履歴取得
- `POST /api/settlements` - 精算実行

### データベース設計概要

#### 主要テーブル
- `users` - ユーザー情報
- `couples` - カップル関係管理
- `expenses` - 支出記録
- `categories` - カテゴリマスタ
- `settlements` - 精算履歴
- `budgets` - 予算設定

### プロジェクト構造
```
futarino-kakei/
├── frontend/          # Next.js アプリケーション
│   ├── src/
│   │   ├── app/       # App Router
│   │   ├── components/
│   │   ├── lib/
│   │   └── types/
│   ├── public/
│   └── package.json
├── backend/           # Laravel API
│   ├── app/
│   │   ├── Http/Controllers/
│   │   ├── Models/
│   │   └── Services/
│   ├── database/
│   │   ├── migrations/
│   │   └── seeders/
│   ├── routes/
│   └── composer.json
└── docs/             # ドキュメント
    ├── api.md
    └── deployment.md
```

### 機能要件

#### 1. ユーザー管理機能
- **ユーザー登録**: 最大2名まで登録可能
- **ログイン機能**: 認証システム
- **ユーザー識別**: 個人別の支出記録管理

#### 2. 支出管理機能
##### 2.1 支出記録
- **支出入力**: 金額、日付、カテゴリ、メモ
- **記録者識別**: どちらのユーザーが支出したかを記録
- **編集・削除**: 精算前の支出は修正可能

##### 2.2 カテゴリ管理
- **既定カテゴリ**: システム標準のカテゴリを用意
  - 食費、光熱費、家賃、交通費、娯楽費、日用品、医療費、その他など
- **カスタムカテゴリ**: ユーザーが独自カテゴリを追加可能

#### 3. 共有・分担機能
##### 3.1 表示モード
- **個別管理ページ**: 各ユーザーの個人支出表示
- **共通管理ページ**: 二人の支出を統合表示

##### 3.2 分担比率設定
- **比率設定**: 支出の分担比率を設定可能（例：50:50、60:40など）
- **カテゴリ別設定**: カテゴリごとに異なる分担比率設定可能

##### 3.3 精算機能
- **精算計算**: 設定した分担比率に基づき支払額を計算
- **支払金額表示**: 片方がもう片方へ支払う金額を表示
- **精算確定**: 精算後は原則として修正不可
- **精算履歴**: 過去の精算記録を保持・表示

#### 4. 分析・レポート機能
##### 4.1 期間別レポート
- **月次レポート**: 月別の支出状況
- **年次レポート**: 年別の支出状況
- **カスタム期間**: 任意期間での集計

##### 4.2 可視化機能
- **グラフ表示**: 円グラフ、棒グラフ、線グラフ
- **カテゴリ別分析**: カテゴリごとの支出割合
- **トレンド分析**: 時系列での支出傾向

#### 5. 予算管理機能
- **月次予算設定**: 月ごとの予算上限設定
- **カテゴリ別予算**: カテゴリごとの予算設定
- **予算対実績**: 予算と実際の支出を比較表示
- **予算アラート**: 予算超過時の警告表示

#### 6. 通知機能
- **予算アラート**: 予算の80%、100%到達時の通知
- **精算リマインド**: 定期的な精算促進通知
- **支出登録リマインド**: 支出記録の促進通知

#### 7. データ管理機能
##### 7.1 インポート・エクスポート
- **CSVアップロード**: 既存データの一括インポート
- **CSVダウンロード**: データの一括エクスポート
- **データフォーマット**: 標準的なCSV形式での入出力

##### 7.2 データ保持
- **保存期間**: 最長3年間のデータ保持
- **自動削除**: 3年経過データの自動削除
- **バックアップ**: データの定期バックアップ

### 画面構成（想定）
#### メイン画面
- **ダッシュボード**: 今月の支出状況、予算残高表示
- **支出入力画面**: 新規支出の登録
- **支出一覧画面**: 個別・共通の支出履歴表示
- **精算画面**: 分担計算と精算実行
- **レポート画面**: グラフ・チャートでの分析表示
- **設定画面**: 分担比率、カテゴリ、予算設定

### 非機能要件
#### セキュリティ
- ユーザー認証の実装
- データの暗号化
- プライバシー保護

#### パフォーマンス
- レスポンシブデザイン
- 高速なデータ処理
- モバイル対応

#### 拡張性
- 将来的な収入管理機能追加に対応
- 追加機能の実装余地を確保

### 開発優先順位（提案）
#### Phase 1（MVP）
- ユーザー管理機能
- 基本的な支出記録機能
- 個別・共通ページ表示
- 基本的な精算機能

#### Phase 2
- カテゴリ管理機能
- 分担比率設定
- CSV入出力機能
- 基本レポート機能

#### Phase 3
- 予算管理機能
- 通知機能
- 高度な分析・可視化機能
- UI/UX改善

### 開発ガイドライン

#### コーディング規約
- **フロントエンド**: ESLint + Prettier設定に従う
- **バックエンド**: PSR-12準拠
- **コミットメッセージ**: Conventional Commits形式

#### ブランチ戦略
- `main`: 本番環境
- `develop`: 開発環境
- `feature/*`: 機能開発
- `hotfix/*`: 緊急修正

#### テスト方針
- **フロントエンド**: Jest + React Testing Library
- **バックエンド**: PHPUnit
- **E2E**: Playwright

### ライセンス
MIT License

### コントリビューション
プルリクエストを歓迎します。大きな変更を行う場合は、まずIssueを作成して議論してください。

### 連絡先
- プロジェクト管理者: [連絡先情報]
- Issue報告: [GitHubリポジトリのIssues]

---

最終更新: 2024年12月
